-- ============================================================================
-- Tattoo Colors
-- ============================================================================

-- Drop existing table if it exists
DROP TABLE IF EXISTS tattoo_colors CASCADE;

-- Create tattoo_colors table
CREATE TABLE tattoo_colors (
    id SERIAL PRIMARY KEY,
    color_name VARCHAR(100) NOT NULL UNIQUE,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    color_type VARCHAR(50) DEFAULT 'standard',
    popularity_rank INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create index for faster lookups
CREATE INDEX idx_tattoo_colors_slug ON tattoo_colors(slug);
CREATE INDEX idx_tattoo_colors_popularity ON tattoo_colors(popularity_rank);
CREATE INDEX idx_tattoo_colors_active ON tattoo_colors(is_active);
CREATE INDEX idx_tattoo_colors_type ON tattoo_colors(color_type);

-- Function to update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to automatically update updated_at
CREATE TRIGGER trigger_tattoo_colors_updated_at
    BEFORE UPDATE ON tattoo_colors
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- Insert tattoo colors data
INSERT INTO tattoo_colors (color_name, slug, description, color_type, popularity_rank) VALUES
('Monochrome (Purple)', 'monochrome-purple', 'Single-color purple designs with varying shades', 'monochrome', 15),
('black', 'black', 'Solid black ink tattoos', 'standard', 1),
('Neon / High-Vibrancy', 'neon-high-vibrancy', 'Extremely bright, fluorescent colors', 'special', 12),
('Jewel Tones', 'jewel-tones', 'Rich, saturated colors resembling gemstones', 'standard', 8),
('Black & Grey Only', 'black-grey-only', 'Tattoos using only black and grey ink', 'standard', 2),
('Duotone', 'duotone', 'Two-color designs with specific color combinations', 'special', 14),
('High-Saturation', 'high-saturation', 'Intensely saturated, vibrant colors', 'standard', 10),
('Pastel', 'pastel', 'Soft, muted colors with low saturation', 'special', 16),
('Full Color', 'full-color', 'Tattoos utilizing a full spectrum of colors', 'standard', 5),
('blue', 'blue', 'Various shades of blue ink', 'standard', 6),
('Black & Grey', 'black-grey', 'Traditional black and grey tattoo style', 'standard', 3),
('green', 'green', 'Various shades of green ink', 'standard', 7),
('white', 'white', 'White ink tattoos, often used for highlights', 'accent', 18),
('yellow', 'yellow', 'Various shades of yellow ink', 'standard', 13),
('Sepia', 'sepia', 'Brown-toned colors resembling antique photographs', 'special', 17),
('Monochrome (Blue)', 'monochrome-blue', 'Single-color blue designs with varying shades', 'monochrome', 11),
('red', 'red', 'Various shades of red ink', 'standard', 4),
('Monochrome (Red)', 'monochrome-red', 'Single-color red designs with varying shades', 'monochrome', 9),
('Muted / Earth Tones', 'muted-earth-tones', 'Subdued, natural colors inspired by earth elements', 'standard', 19),
('Monochrome (Green)', 'monochrome-green', 'Single-color green designs with varying shades', 'monochrome', 20),
('White-Ink Accents', 'white-ink-accents', 'White ink used for highlights and accents', 'accent', 21)
ON CONFLICT (color_name) DO UPDATE SET
    slug = EXCLUDED.slug,
    description = EXCLUDED.description,
    color_type = EXCLUDED.color_type,
    popularity_rank = EXCLUDED.popularity_rank,
    updated_at = CURRENT_TIMESTAMP;

-- Create a view for active colors
CREATE OR REPLACE VIEW active_tattoo_colors AS
SELECT id, color_name, slug, description, color_type, popularity_rank, created_at, updated_at
FROM tattoo_colors
WHERE is_active = TRUE
ORDER BY popularity_rank ASC, color_name ASC;

-- Create a view for colors by type
CREATE OR REPLACE VIEW tattoo_colors_by_type AS
SELECT 
    color_type,
    COUNT(*) as color_count,
    ARRAY_AGG(color_name ORDER BY popularity_rank) as colors
FROM tattoo_colors
WHERE is_active = TRUE
GROUP BY color_type
ORDER BY color_type;