-- ============================================================================
-- Tattoo Moods
-- ============================================================================

-- Drop existing table if it exists
DROP TABLE IF EXISTS tattoo_moods CASCADE;

-- Create tattoo_moods table
CREATE TABLE tattoo_moods (
    id SERIAL PRIMARY KEY,
    mood_name VARCHAR(100) NOT NULL UNIQUE,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    mood_type VARCHAR(50) DEFAULT 'general',
    intensity_level INTEGER DEFAULT 3 CHECK (intensity_level BETWEEN 1 AND 5),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create index for faster lookups
CREATE INDEX idx_tattoo_moods_slug ON tattoo_moods(slug);
CREATE INDEX idx_tattoo_moods_type ON tattoo_moods(mood_type);
CREATE INDEX idx_tattoo_moods_intensity ON tattoo_moods(intensity_level);
CREATE INDEX idx_tattoo_moods_active ON tattoo_moods(is_active);

-- Function to update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to automatically update updated_at
CREATE TRIGGER trigger_tattoo_moods_updated_at
    BEFORE UPDATE ON tattoo_moods
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- Insert tattoo moods data
INSERT INTO tattoo_moods (mood_name, slug, description, mood_type, intensity_level) VALUES
('Aggressive', 'aggressive', 'Bold, intense, and confrontational designs', 'intense', 5),
('Angry', 'angry', 'Expressions of rage, frustration, or strong negative emotions', 'emotional', 5),
('Anxious', 'anxious', 'Nervous, worried, or tense emotional states', 'emotional', 3),
('Bold', 'bold', 'Confident, striking, and attention-grabbing designs', 'expressive', 4),
('Calm', 'calm', 'Peaceful, serene, and tranquil emotional states', 'emotional', 1),
('Confident', 'confident', 'Self-assured and assertive emotional expression', 'expressive', 4),
('Dark', 'dark', 'Mysterious, ominous, or macabre themes', 'thematic', 4),
('Delicate', 'delicate', 'Subtle, gentle, and refined designs', 'subtle', 2),
('Depressed', 'depressed', 'Sad, melancholic, or hopeless emotional states', 'emotional', 4),
('Determined', 'determined', 'Focused, resolute, and purposeful emotional states', 'expressive', 4),
('Elegant', 'elegant', 'Sophisticated, graceful, and refined designs', 'aesthetic', 3),
('Empowered', 'empowered', 'Strong, capable, and in-control emotional states', 'expressive', 4),
('Energetic', 'energetic', 'Lively, dynamic, and vibrant emotional states', 'expressive', 4),
('Fearful', 'fearful', 'Scared, apprehensive, or terrified emotional states', 'emotional', 4),
('Feminine', 'feminine', 'Graceful, delicate, and traditionally female-associated aesthetics', 'aesthetic', 3),
('Fierce', 'fierce', 'Intense, powerful, and formidable emotional expression', 'intense', 5),
('Gentle', 'gentle', 'Soft, kind, and tender emotional states', 'emotional', 2),
('Happy', 'happy', 'Joyful, cheerful, and positive emotional states', 'emotional', 3),
('Hopeful', 'hopeful', 'Optimistic, expectant, and forward-looking emotional states', 'emotional', 3),
('Humorous', 'humorous', 'Funny, playful, and lighthearted designs', 'expressive', 2),
('Intense', 'intense', 'Powerful, concentrated, and deeply felt emotional states', 'intense', 5),
('Intimate', 'intimate', 'Personal, private, and deeply meaningful emotional states', 'emotional', 3),
('Joyful', 'joyful', 'Extremely happy, ecstatic, and celebratory emotional states', 'emotional', 4),
('Lonely', 'lonely', 'Isolated, solitary, or disconnected emotional states', 'emotional', 3),
('Loving', 'loving', 'Affectionate, caring, and compassionate emotional states', 'emotional', 3),
('Masculine', 'masculine', 'Strong, bold, and traditionally male-associated aesthetics', 'aesthetic', 4),
('Melancholic', 'melancholic', 'Thoughtful, pensive, and slightly sad emotional states', 'emotional', 3),
('Mysterious', 'mysterious', 'Enigmatic, cryptic, and puzzling designs', 'thematic', 3),
('Nostalgic', 'nostalgic', 'Sentimental, reminiscent, and longing for the past', 'emotional', 3),
('Optimistic', 'optimistic', 'Positive, hopeful, and expecting good outcomes', 'emotional', 3),
('Peaceful', 'peaceful', 'Tranquil, calm, and harmonious emotional states', 'emotional', 2),
('Playful', 'playful', 'Fun, lighthearted, and mischievous designs', 'expressive', 2),
('Powerful', 'powerful', 'Strong, influential, and commanding emotional states', 'expressive', 5),
('Proud', 'proud', 'Satisfied, accomplished, and self-respecting emotional states', 'emotional', 4),
('Quiet', 'quiet', 'Still, silent, and subdued emotional states', 'emotional', 2),
('Rebellious', 'rebellious', 'Defiant, non-conformist, and anti-establishment themes', 'thematic', 4),
('Reflective', 'reflective', 'Thoughtful, contemplative, and introspective emotional states', 'emotional', 3),
('Relaxed', 'relaxed', 'Easygoing, comfortable, and stress-free emotional states', 'emotional', 2),
('Romantic', 'romantic', 'Loving, passionate, and affectionate emotional states', 'emotional', 4),
('Sad', 'sad', 'Unhappy, sorrowful, or grieving emotional states', 'emotional', 4),
('Scared', 'scared', 'Frightened, alarmed, or terrified emotional states', 'emotional', 4),
('Serene', 'serene', 'Calm, peaceful, and untroubled emotional states', 'emotional', 2),
('Sexy', 'sexy', 'Alluring, seductive, and sensual designs', 'expressive', 4),
('Silly', 'silly', 'Goofy, absurd, and nonsensical designs', 'expressive', 2),
('Spiritual', 'spiritual', 'Religious, mystical, or transcendent themes', 'thematic', 4),
('Strong', 'strong', 'Powerful, resilient, and enduring emotional states', 'expressive', 4),
('Subtle', 'subtle', 'Understated, delicate, and not obvious designs', 'aesthetic', 2),
('Tense', 'tense', 'Nervous, anxious, or stressed emotional states', 'emotional', 4),
('Thoughtful', 'thoughtful', 'Considerate, reflective, and mindful emotional states', 'emotional', 3),
('Vulnerable', 'vulnerable', 'Open, exposed, and emotionally raw states', 'emotional', 4),
('Whimsical', 'whimsical', 'Playful, fanciful, and imaginative designs', 'expressive', 2),
('Wild', 'wild', 'Untamed, free-spirited, and unconventional designs', 'expressive', 4)
ON CONFLICT (mood_name) DO UPDATE SET
    slug = EXCLUDED.slug,
    description = EXCLUDED.description,
    mood_type = EXCLUDED.mood_type,
    intensity_level = EXCLUDED.intensity_level,
    updated_at = CURRENT_TIMESTAMP;

-- Create a view for active moods
CREATE OR REPLACE VIEW active_tattoo_moods AS
SELECT id, mood_name, slug, description, mood_type, intensity_level, created_at, updated_at
FROM tattoo_moods
WHERE is_active = TRUE
ORDER BY mood_type, mood_name ASC;

-- Create a view for moods by type
CREATE OR REPLACE VIEW tattoo_moods_by_type AS
SELECT 
    mood_type,
    COUNT(*) as mood_count,
    ARRAY_AGG(mood_name ORDER BY intensity_level DESC, mood_name) as moods
FROM tattoo_moods
WHERE is_active = TRUE
GROUP BY mood_type
ORDER BY mood_type;

-- Create a view for moods by intensity level
CREATE OR REPLACE VIEW tattoo_moods_by_intensity AS
SELECT 
    intensity_level,
    COUNT(*) as mood_count,
    ARRAY_AGG(mood_name ORDER BY mood_name) as moods
FROM tattoo_moods
WHERE is_active = TRUE
GROUP BY intensity_level
ORDER BY intensity_level DESC;