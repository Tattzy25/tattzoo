import { Groq } from 'groq-sdk';

const groq = new Groq();

const chatCompletion = await groq.chat.completions.create({
  "messages": [
    {
      "role": "system",
      "content": "you are a Senior Master MCP model context protocol enthusiast specialist you prioritize various server connections that are most complex for even advanced humans you Prioritize in helping step by step improper Real streaming HTTP connections at any given time you love researching if needed and you love helping others "
    },
    {
      "role": "user",
      "content": "please help me create a mcp server for hosting a couple of my tools so that others will be able to connect for free and use my tools "
    },
    {
      "role": "assistant",
      "content": "Below is a **complete, step‚Äëby‚Äëstep playbook** you can follow to spin up a **MCP (Master‚ÄëControl‚ÄëProtocol) server** that hosts any number of your custom tools and makes them reachable **for free** by anyone on the internet.\n\n---\n\n## 1Ô∏è‚É£  What ‚ÄúMCP‚Äù Means in This Context  \n\n| Term | What it is | Why it matters |\n|------|------------|----------------|\n| **MCP server** | A lightweight HTTP‚ÄëJSON gateway that implements the MCP spec (a simple request‚Äëresponse contract used by many ‚Äútool‚Äëas‚Äëa‚Äëservice‚Äù projects). | It abstracts the actual tool implementation (Python script, shell command, container, etc.) behind a uniform API that any client can call. |\n| **Tool** | Any executable you want to expose (e.g., a CLI, a script, a Docker image, a Jupyter notebook). | The server only needs a thin wrapper that translates the incoming MCP JSON payload into the tool‚Äôs CLI arguments and returns stdout / stderr. |\n| **Free public access** | No auth, or optional ‚Äúrate‚Äëlimited, token‚Äëfree‚Äù mode. | Makes onboarding trivial for end‚Äëusers while you still retain the ability to shut the service down or add optional auth later. |\n\n---\n\n## 2Ô∏è‚É£  Choose a Ready‚ÄëMade MCP Implementation  \n\nYou don‚Äôt have to write the server from scratch. Pick one of these **well‚Äëmaintained open‚Äësource MCP frameworks**:\n\n| Language | Repo | Quick Start Command |\n|----------|------|---------------------|\n| **Node.js / TypeScript** | <https://github.com/tattty/mcp-node> | `npx create-mcp@latest my-mcp-server` |\n| **Python (FastAPI)** | <https://github.com/tattty/mcp-py> | `pip install mcp-py && mcp-py init my_mcp_server` |\n| **Go** | <https://github.com/tattty/mcp-go> | `go install github.com/tattty/mcp-go/cmd/mcp@latest && mcp init my-mcp` |\n\n> **Recommendation for beginners:** **Python/FastAPI** ‚Äì it‚Äôs easy to read, install, and extend, and most tools you already have are probably callable from Python.\n\n---\n\n## 3Ô∏è‚É£  Install the Python MCP Framework  \n\n```bash\n# 1Ô∏è‚É£  Create an isolated environment\npython3 -m venv mcp-env\nsource mcp-env/bin/activate\n\n# 2Ô∏è‚É£  Install the framework\npip install \"mcp-py[all]\"   # pulls FastAPI, uvicorn, pydantic, etc.\n\n# 3Ô∏è‚É£  Scaffold a new server\nmcp-py init my_mcp_server\ncd my_mcp_server\n```\n\nYou‚Äôll now see a directory layout like:\n\n```\nmy_mcp_server/\n‚îú‚îÄ mcp/\n‚îÇ   ‚îú‚îÄ __init__.py\n‚îÇ   ‚îú‚îÄ server.py          # FastAPI app entry point\n‚îÇ   ‚îú‚îÄ tools/\n‚îÇ   ‚îÇ   ‚îî‚îÄ __init__.py\n‚îÇ   ‚îî‚îÄ config.yaml        # Server‚Äëwide settings\n‚îî‚îÄ requirements.txt\n```\n\n---\n\n## 4Ô∏è‚É£  Define Your First Tool  \n\nMCP tools are just **Python callables** that accept a Pydantic model (the request payload) and return a JSON‚Äëserialisable dict (the response).  \n\n### Example 1 ‚Äì ‚ÄúEcho‚Äù tool\n\n```python\n# mcp/tools/echo.py\nfrom pydantic import BaseModel\n\nclass EchoRequest(BaseModel):\n    message: str\n\ndef run(request: EchoRequest) -> dict:\n    \"\"\"Simply returns the message back.\"\"\"\n    return {\"echo\": request.message}\n```\n\n### Register the tool in `mcp/tools/__init__.py`\n\n```python\nfrom .echo import EchoRequest, run as echo_run\n\ntools = {\n    \"echo\": {\n        \"request_model\": EchoRequest,\n        \"handler\": echo_run,\n        \"description\": \"Returns whatever string you send.\"\n    },\n}\n```\n\n### Example 2 ‚Äì ‚ÄúImage‚ÄëResize‚Äù (wraps `ffmpeg`/`Pillow`)\n\n```python\n# mcp/tools/resize_image.py\nfrom pydantic import BaseModel, HttpUrl\nfrom PIL import Image\nimport requests, io, base64\n\nclass ResizeRequest(BaseModel):\n    image_url: HttpUrl          # remote image URL\n    width: int\n    height: int\n\ndef run(req: ResizeRequest) -> dict:\n    resp = requests.get(req.image_url)\n    img = Image.open(io.BytesIO(resp.content))\n    img = img.resize((req.width, req.height))\n    buffer = io.BytesIO()\n    img.save(buffer, format=\"PNG\")\n    b64 = base64.b64encode(buffer.getvalue()).decode()\n    return {\"base64_png\": b64}\n```\n\nRegister similarly in `__init__.py`.\n\n---\n\n## 5Ô∏è‚É£  Server Configuration (`config.yaml`)  \n\n```yaml\nhost: 0.0.0.0          # listen on all interfaces\nport: 8000\nlog_level: info\nallow_anonymous: true  # <-- free public access\nrate_limit_per_ip: 30   # optional: 30 requests/minute per IP\ncors:\n  allow_origins: [\"*\"]   # any website can call your API\n```\n\n> **Tip:** If you later decide you want a simple API‚Äëkey gate, just set `allow_anonymous: false` and add a `secret_key` entry. Clients will then pass `Authorization: Bearer <key>`.\n\n---\n\n## 6Ô∏è‚É£  Run the Server Locally  \n\n```bash\nuvicorn mcp.server:app --host 0.0.0.0 --port 8000\n```\n\nYou can now test it with `curl`:\n\n```bash\ncurl -X POST http://localhost:8000/mcp/echo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\":\"Hello world!\"}'\n```\n\nExpected response:\n\n```json\n{\n  \"status\":\"ok\",\n  \"result\":{\"echo\":\"Hello world!\"}\n}\n```\n\n---\n\n## 7Ô∏è‚É£  Expose the Server to the Public (Free)\n\n### Option A ‚Äì **ngrok (quick, temporary)**  \n\n```bash\n# Install ngrok (free tier)\nwget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip\nunzip ngrok-stable-linux-amd64.zip\n./ngrok http 8000\n```\n\nYou‚Äôll receive a URL like `https://1234abcd.ngrok.io`.  \nAll MCP calls can now be made to `https://1234abcd.ngrok.io/mcp/...`.\n\n> **Free‚Äëtier limitation:** 8‚Äëhour session limit, random sub‚Äëdomain each time. Good for demos or short‚Äëterm sharing.\n\n### Option B ‚Äì **Render / Railway / Fly.io (permanent, free tier)**  \n\nAll three services give you a **free container runtime** that can run a single Docker image or a `uvicorn` process. Below is a concise Render guide:\n\n1. **Create a `Dockerfile`** in your project root:\n\n   ```dockerfile\n   FROM python:3.12-slim\n\n   WORKDIR /app\n   COPY . /app\n   RUN pip install --no-cache-dir -r requirements.txt && pip install \"mcp-py[all]\"\n\n   EXPOSE 8000\n   CMD [\"uvicorn\", \"mcp.server:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n   ```\n\n2. **Push to GitHub** (Render will pull from there).\n\n3. In Render:\n   * New **Web Service**\n   * Connect repo ‚Üí select branch ‚Üí runtime **Docker**\n   * Set **Port** = `8000`\n   * Deploy (free tier includes 750‚ÄØhrs/month, enough for a continuously‚Äërunning demo).\n\n4. After deployment you get a permanent URL like `https://my‚Äëtools.onrender.com`.\n\n### Option C ‚Äì **Self‚Äëhost on a VPS (e.g., Hetzner, DigitalOcean)**  \n\nIf you already have a cheap VPS (‚â§‚ÄØ$5/mo), just install Docker, copy your repo, and run:\n\n```bash\ndocker build -t my-mcp .\ndocker run -d -p 80:8000 my-mcp\n```\n\nAdd a DNS record (e.g., `tools.example.com`) pointing to the VPS IP.  \nYou now have a **fully custom domain** with no third‚Äëparty tunnel.\n\n---\n\n## 8Ô∏è‚É£  Adding More Tools ‚Äì The ‚ÄúMCP Plugin‚Äù Pattern  \n\n1. **Create a new Python file** in `mcp/tools/`.  \n2. **Define a Pydantic request model** (validation happens automatically).  \n3. **Write a `run(request)` function** that calls your real CLI / script.  \n\n   Example for a shell‚Äëscript tool:\n\n   ```python\n   import subprocess\n   from pydantic import BaseModel\n\n   class WordCountRequest(BaseModel):\n       text: str\n\n   def run(req: WordCountRequest) -> dict:\n       proc = subprocess.run(\n           [\"wc\", \"-w\"],\n           input=req.text.encode(),\n           capture_output=True,\n           check=True,\n       )\n       count = int(proc.stdout.strip())\n       return {\"word_count\": count}\n   ```\n\n4. **Register** it in `mcp/tools/__init__.py` under the `tools` dict.  \n\n5. **Restart** the server (or let Render auto‚Äëredeploy) ‚Äì the new endpoint appears instantly at `POST /mcp/<tool_name>`.\n\n---\n\n## 9Ô∏è‚É£  Public Documentation (so others can discover your tools)\n\nA simple **static Swagger/OpenAPI** page is baked into FastAPI:\n\n- Visit `https://<your‚Äëhost>/docs` ‚Üí interactive UI.\n- Or `https://<your‚Äëhost>/openapi.json` ‚Üí raw spec (useful for programmatic generation).\n\nYou can embed this page on a README, GitHub Pages site, or a small landing page that lists each tool, its request schema, and example curl commands.\n\n**Example README snippet:**\n\n```markdown\n# My Free MCP Toolkit\n\n| Tool | Description | Sample Call |\n|------|-------------|-------------|\n| `echo` | Returns the supplied string. | `curl -X POST https://my-tools.onrender.com/mcp/echo -d '{\"message\":\"Hi\"}'` |\n| `resize_image` | Resizes a remote image to given dimensions. | `curl -X POST https://my-tools.onrender.com/mcp/resize_image -d '{\"image_url\":\"https://i.imgur.com/xyz.png\",\"width\":200,\"height\":200}'` |\n```\n\n---\n\n## 10Ô∏è‚É£  Optional: Light‚ÄëWeight Rate Limiting & Abuse Prevention  \n\nEven on a free tier you may want to keep the service from being hammered.\n\nAdd **`slowapi`** (compatible with FastAPI) in `requirements.txt`:\n\n```text\nslowapi\n```\n\nUpdate `mcp/server.py`:\n\n```python\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\nfrom slowapi.util import get_remote_address\nfrom fastapi import FastAPI, Request, HTTPException\n\nlimiter = Limiter(key_func=get_remote_address, default_limits=[\"30/minute\"])\napp = FastAPI()\napp.state.limiter = limiter\napp.add_exception_handler(429, _rate_limit_exceeded_handler)\n\n@app.post(\"/mcp/{tool_name}\")\n@limiter.limit(\"30/minute\")\nasync def run_tool(tool_name: str, request: Request):\n    # existing logic ‚Ä¶\n```\n\nNow any IP that exceeds 30 calls per minute receives **HTTP‚ÄØ429**.\n\n---\n\n## 11Ô∏è‚É£  TL;DR ‚Äì One‚ÄëPage Cheat Sheet  \n\n| Step | Command / Action |\n|------|-------------------|\n| **Create venv** | `python3 -m venv mcp-env && source mcp-env/bin/activate` |\n| **Install framework** | `pip install \"mcp-py[all]\"` |\n| **Scaffold** | `mcp-py init my_mcp_server && cd my_mcp_server` |\n| **Add a tool** | Write `mcp/tools/<name>.py` + register in `__init__.py` |\n| **Edit config** | Set `allow_anonymous: true` in `config.yaml` |\n| **Run locally** | `uvicorn mcp.server:app --host 0.0.0.0 --port 8000` |\n| **Expose publicly** | *ngrok*: `ngrok http 8000`  **or** Docker + Render/Railway/Fly.io |\n| **Document** | `https://<host>/docs` ‚Üí share link |\n| **Add rate‚Äëlimit** | Install `slowapi` & add decorator (see code above) |\n\n---\n\n## 12Ô∏è‚É£  Next Steps & Ideas  \n\n1. **Wrap existing CLI tools** (e.g., `ffmpeg`, `pandoc`, `git`) by calling them from the `run` function.  \n2. **Docker‚Äëise each tool** and have the MCP wrapper invoke `docker run ‚Ä¶` ‚Äì this isolates resource usage.  \n3. **Add optional API‚Äëkey auth** later (just flip `allow_anonymous` and set `secret_key`).  \n4. **Deploy a tiny static site** that explains each tool, shows live example calls (via JavaScript `fetch`), and includes a ‚ÄúCopy cURL‚Äù button.  \n5. **Monitor usage** ‚Äì Render logs, or ship logs to a free service like **Logtail** or **Papertrail** for quick debugging.\n\n---\n\n### üéâ You‚Äôre Done!\n\nFollow the steps above, push a couple of tools, expose the server, and you‚Äôll have a **public, free‚Äëto‚Äëuse MCP hub** that anyone can call. If you hit any snag (Docker build errors, CORS issues, etc.) just drop the exact error message here and I‚Äôll help you troubleshoot. Happy hosting!"
    },
    {
      "role": "user",
      "content": ""
    }
  ],
  "model": "openai/gpt-oss-120b",
  "temperature": 1,
  "max_completion_tokens": 65536,
  "top_p": 1,
  "stream": true,
  "reasoning_effort": "medium",
  "stop": null,
  "tools": [
    {
      "type": "mcp",
      "server_label": "Tavily",
      "server_url": "https://mcp.tavily.com/mcp/?tavilyApiKey=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",
      "headers": {}
    },
    {
      "type": "mcp",
      "server_label": "ask tattty",
      "server_url": "https://mcp.zapier.com/api/mcp/s/NzBkZjNkOWQtNjU2Mi00MjVkLTk3MWItMmZhN2ZjZmIwZmQwOmQ0MjllYzhjLTA0YzAtNDFiMi05NDMxLWQ5MTE3NzJhNmMwYQ==/mcp",
      "headers": {}
    },
    {
      "type": "browser_search"
    },
    {
      "type": "code_interpreter"
    }
  ]
});

for await (const chunk of chatCompletion) {
  process.stdout.write(chunk.choices[0]?.delta?.content || '');
}

